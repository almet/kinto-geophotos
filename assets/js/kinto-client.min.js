(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.KintoClient = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,n,i,s,r,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],isUndefined(n))return!1;if(isFunction(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(isObject(n))for(s=Array.prototype.slice.call(arguments,1),o=n.slice(),i=o.length,r=0;i>r;r++)o[r].apply(this,s);return!0},EventEmitter.prototype.addListener=function(e,t){var n;if(!isFunction(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned&&(n=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!isFunction(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},EventEmitter.prototype.removeListener=function(e,t){var n,i,s,r;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],s=n.length,i=-1,n===t||isFunction(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(n)){for(r=s;r-- >0;)if(n[r]===t||n[r].listener&&n[r].listener===t){i=r;break}if(0>i)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],isFunction(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(isFunction(t))return 1;if(t)return t.length}return 0},EventEmitter.listenerCount=function(e,t){return e.listenerCount(t)};

},{}],2:[function(require,module,exports){
require("whatwg-fetch"),module.exports=self.fetch.bind(self);

},{"whatwg-fetch":3}],3:[function(require,module,exports){
!function(t){"use strict";function e(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function r(t){return"string"!=typeof t&&(t=String(t)),t}function o(t){this.map={},t instanceof o?t.forEach(function(t,e){this.append(e,t)},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function n(t){return t.bodyUsed?Promise.reject(new TypeError("Already read")):void(t.bodyUsed=!0)}function s(t){return new Promise(function(e,r){t.onload=function(){e(t.result)},t.onerror=function(){r(t.error)}})}function i(t){var e=new FileReader;return e.readAsArrayBuffer(t),s(e)}function a(t){var e=new FileReader;return e.readAsText(t),s(e)}function h(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,"string"==typeof t)this._bodyText=t;else if(c.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(c.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(t){if(!c.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t))throw new Error("unsupported BodyInit type")}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type&&this.headers.set("content-type",this._bodyBlob.type))},c.blob?(this.blob=function(){var t=n(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(i)},this.text=function(){var t=n(this);if(t)return t;if(this._bodyBlob)return a(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var t=n(this);return t?t:Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(f)}),this.json=function(){return this.text().then(JSON.parse)},this}function u(t){var e=t.toUpperCase();return y.indexOf(e)>-1?e:t}function d(t,e){e=e||{};var r=e.body;if(d.prototype.isPrototypeOf(t)){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new o(t.headers)),this.method=t.method,this.mode=t.mode,r||(r=t._bodyInit,t.bodyUsed=!0)}else this.url=t;if(this.credentials=e.credentials||this.credentials||"omit",(e.headers||!this.headers)&&(this.headers=new o(e.headers)),this.method=u(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function f(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var r=t.split("="),o=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(o),decodeURIComponent(n))}}),e}function p(t){var e=new o,r=t.getAllResponseHeaders().trim().split("\n");return r.forEach(function(t){var r=t.trim().split(":"),o=r.shift().trim(),n=r.join(":").trim();e.append(o,n)}),e}function l(t,e){e||(e={}),this.type="default",this.status=e.status,this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText,this.headers=e.headers instanceof o?e.headers:new o(e.headers),this.url=e.url||"",this._initBody(t)}if(!t.fetch){o.prototype.append=function(t,o){t=e(t),o=r(o);var n=this.map[t];n||(n=[],this.map[t]=n),n.push(o)},o.prototype["delete"]=function(t){delete this.map[e(t)]},o.prototype.get=function(t){var r=this.map[e(t)];return r?r[0]:null},o.prototype.getAll=function(t){return this.map[e(t)]||[]},o.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},o.prototype.set=function(t,o){this.map[e(t)]=[r(o)]},o.prototype.forEach=function(t,e){Object.getOwnPropertyNames(this.map).forEach(function(r){this.map[r].forEach(function(o){t.call(e,o,r,this)},this)},this)};var c={blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t},y=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];d.prototype.clone=function(){return new d(this)},h.call(d.prototype),h.call(l.prototype),l.prototype.clone=function(){return new l(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new o(this.headers),url:this.url})},l.error=function(){var t=new l(null,{status:0,statusText:""});return t.type="error",t};var b=[301,302,303,307,308];l.redirect=function(t,e){if(-1===b.indexOf(e))throw new RangeError("Invalid status code");return new l(null,{status:e,headers:{location:t}})},t.Headers=o,t.Request=d,t.Response=l,t.fetch=function(t,e){return new Promise(function(r,o){function n(){return"responseURL"in i?i.responseURL:/^X-Request-URL:/m.test(i.getAllResponseHeaders())?i.getResponseHeader("X-Request-URL"):void 0}var s;s=d.prototype.isPrototypeOf(t)&&!e?t:new d(t,e);var i=new XMLHttpRequest;i.onload=function(){var t=1223===i.status?204:i.status;if(100>t||t>599)return void o(new TypeError("Network request failed"));var e={status:t,statusText:i.statusText,headers:p(i),url:n()},s="response"in i?i.response:i.responseText;r(new l(s,e))},i.onerror=function(){o(new TypeError("Network request failed"))},i.open(s.method,s.url,!0),"include"===s.credentials&&(i.withCredentials=!0),"responseType"in i&&c.blob&&(i.responseType="blob"),s.headers.forEach(function(t,e){i.setRequestHeader(e,t)}),i.send("undefined"==typeof s._bodyInit?null:s._bodyInit)})},t.fetch.polyfill=!0}}("undefined"!=typeof self?self:this);

},{}],4:[function(require,module,exports){
"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _applyDecoratedDescriptor(e,t,r,n,s){var i={};return Object.keys(n).forEach(function(e){i[e]=n[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},i),s&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(s):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=exports.SUPPORTED_PROTOCOL_VERSION=void 0;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_dec,_dec2,_dec3,_dec4,_dec5,_dec6,_desc,_value,_class,_utils=require("./utils"),_http=require("./http"),_http2=_interopRequireDefault(_http),_endpoint=require("./endpoint"),_endpoint2=_interopRequireDefault(_endpoint),_requests=require("./requests"),requests=_interopRequireWildcard(_requests),_batch=require("./batch"),_bucket2=require("./bucket"),_bucket3=_interopRequireDefault(_bucket2),SUPPORTED_PROTOCOL_VERSION=exports.SUPPORTED_PROTOCOL_VERSION="v1",KintoClientBase=(_dec=(0,_utils.nobatch)("This operation is not supported within a batch operation."),_dec2=(0,_utils.nobatch)("This operation is not supported within a batch operation."),_dec3=(0,_utils.nobatch)("This operation is not supported within a batch operation."),_dec4=(0,_utils.nobatch)("This operation is not supported within a batch operation."),_dec5=(0,_utils.nobatch)("Can't use batch within a batch!"),_dec6=(0,_utils.support)("1.4","2.0"),_class=function(){function e(t){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(_classCallCheck(this,e),"string"!=typeof t||!t.length)throw new Error("Invalid remote URL: "+t);"/"===t[t.length-1]&&(t=t.slice(0,-1)),this._backoffReleaseTime=null,this.defaultReqOptions={bucket:r.bucket||"default",headers:r.headers||{},safe:!!r.safe},this._options=r,this._requests=[],this._isBatch=!!r.batch,this.remote=t,this.serverInfo=null,this.events=r.events,this.http=new _http2["default"](this.events,{requestMode:r.requestMode}),this._registerHTTPEvents()}return _createClass(e,[{key:"_registerHTTPEvents",value:function(){var e=this;this.events.on("backoff",function(t){e._backoffReleaseTime=t})}},{key:"bucket",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=(0,_utils.omit)(this._getRequestOptions(t),"bucket");return new _bucket3["default"](this,e,r)}},{key:"_getRequestOptions",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return _extends({},this.defaultReqOptions,e,{batch:this._isBatch,headers:_extends({},this.defaultReqOptions.headers,e.headers)})}},{key:"fetchServerInfo",value:function(){var e=this;return this.serverInfo?Promise.resolve(this.serverInfo):this.http.request(this.remote+(0,_endpoint2["default"])("root"),{headers:this.defaultReqOptions.headers}).then(function(t){var r=t.json;return e.serverInfo=r,e.serverInfo})}},{key:"fetchServerSettings",value:function(){return this.fetchServerInfo().then(function(e){var t=e.settings;return t})}},{key:"fetchServerCapabilities",value:function(){return this.fetchServerInfo().then(function(e){var t=e.capabilities;return t})}},{key:"fetchUser",value:function(){return this.fetchServerInfo().then(function(e){var t=e.user;return t})}},{key:"fetchHTTPApiVersion",value:function(){return this.fetchServerInfo().then(function(e){var t=e.http_api_version;return t})}},{key:"_batchRequests",value:function(e){var t=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=_extends({},this.defaultReqOptions.headers,r.headers);return e.length?this.fetchServerSettings().then(function(s){var i=s.batch_max_requests;if(i&&e.length>i){var o=(0,_utils.partition)(e,i);return(0,_utils.pMap)(o,function(e){return t._batchRequests(e,r)})}return t.execute({path:(0,_endpoint2["default"])("batch"),method:"POST",headers:n,body:{defaults:{headers:n},requests:e}}).then(function(e){var t=e.responses;return t})}):Promise.resolve([])}},{key:"batch",value:function(t){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=new e(this.remote,_extends({},this._options,this._getRequestOptions(r),{batch:!0})),s=void 0,i=void 0;r.bucket&&(s=n.bucket(r.bucket),r.collection&&(i=s.collection(r.collection)));var o=i||s||n;try{t(o)}catch(a){return Promise.reject(a)}return this._batchRequests(n._requests,r).then(function(e){return r.aggregate?(0,_batch.aggregate)(e,n._requests):e})}},{key:"execute",value:function(e){var t=this,r=arguments.length<=1||void 0===arguments[1]?{raw:!1}:arguments[1];if(this._isBatch){this._requests.push(e);var n="This result is generated from within a batch operation and should not be consumed.";return Promise.resolve(r.raw?{json:n}:n)}var s=this.fetchServerSettings().then(function(r){return t.http.request(t.remote+e.path,_extends({},e,{body:JSON.stringify(e.body)}))});return r.raw?s:s.then(function(e){var t=e.json;return t})}},{key:"listBuckets",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this.execute({path:(0,_endpoint2["default"])("buckets"),headers:_extends({},this.defaultReqOptions.headers,e.headers)})}},{key:"createBucket",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=this._getRequestOptions(t);return this.execute(requests.createBucket(e,r))}},{key:"deleteBucket",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r="object"===("undefined"==typeof e?"undefined":_typeof(e))?e:{id:e},n=this._getRequestOptions(t);return this.execute(requests.deleteBucket(r,n))}},{key:"deleteBuckets",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this._getRequestOptions(e);return this.execute(requests.deleteBuckets(t))}},{key:"remote",get:function(){return this._remote},set:function(e){var t=void 0;try{t=e.match(/\/(v\d+)\/?$/)[1]}catch(r){throw new Error("The remote URL must contain the version: "+e)}if(t!==SUPPORTED_PROTOCOL_VERSION)throw new Error("Unsupported protocol version: "+t);this._remote=e,this._version=t}},{key:"version",get:function(){return this._version}},{key:"backoff",get:function(){var e=(new Date).getTime();return this._backoffReleaseTime&&e<this._backoffReleaseTime?this._backoffReleaseTime-e:0}}]),e}(),_applyDecoratedDescriptor(_class.prototype,"fetchServerSettings",[_dec],Object.getOwnPropertyDescriptor(_class.prototype,"fetchServerSettings"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"fetchServerCapabilities",[_dec2],Object.getOwnPropertyDescriptor(_class.prototype,"fetchServerCapabilities"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"fetchUser",[_dec3],Object.getOwnPropertyDescriptor(_class.prototype,"fetchUser"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"fetchHTTPApiVersion",[_dec4],Object.getOwnPropertyDescriptor(_class.prototype,"fetchHTTPApiVersion"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"batch",[_dec5],Object.getOwnPropertyDescriptor(_class.prototype,"batch"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"deleteBuckets",[_dec6],Object.getOwnPropertyDescriptor(_class.prototype,"deleteBuckets"),_class.prototype),_class);exports["default"]=KintoClientBase;

},{"./batch":5,"./bucket":6,"./endpoint":8,"./http":10,"./requests":12,"./utils":13}],5:[function(require,module,exports){
"use strict";function aggregate(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];if(e.length!==t.length)throw new Error("Responses length should match requests one.");var r={errors:[],published:[],conflicts:[],skipped:[]};return e.reduce(function(e,r,s){var o=r.status;return o>=200&&400>o?e.published.push(r.body):404===o?e.skipped.push(r.body):412===o?e.conflicts.push({type:"outgoing",local:t[s].body,remote:r.body.details&&r.body.details.existing||null}):e.errors.push({path:r.path,sent:t[s],error:r.body}),e},r)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.aggregate=aggregate;

},{}],6:[function(require,module,exports){
"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_utils=require("./utils"),_collection=require("./collection"),_collection2=_interopRequireDefault(_collection),_requests=require("./requests"),requests=_interopRequireWildcard(_requests),_endpoint=require("./endpoint"),_endpoint2=_interopRequireDefault(_endpoint),Bucket=function(){function e(t,n){var i=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];_classCallCheck(this,e),this.client=t,this.name=n,this.options=i,this._isBatch=!!i.batch}return _createClass(e,[{key:"_bucketOptions",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=_extends({},this.options&&this.options.headers,e.headers);return _extends({},this.options,e,{headers:t,bucket:this.name,batch:this._isBatch})}},{key:"collection",value:function(e,t){return new _collection2["default"](this.client,this,e,this._bucketOptions(t))}},{key:"getAttributes",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this.client.execute({path:(0,_endpoint2["default"])("bucket",this.name),headers:_extends({},this.options.headers,e.headers)})}},{key:"listCollections",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this.client.execute({path:(0,_endpoint2["default"])("collections",this.name),headers:_extends({},this.options.headers,e.headers)})}},{key:"createCollection",value:function(e,t){var n=this._bucketOptions(t),i=requests.createCollection(e,n);return this.client.execute(i)}},{key:"deleteCollection",value:function(e,t){var n=this._bucketOptions(t),i=requests.deleteCollection((0,_utils.toDataBody)(e),n);return this.client.execute(i)}},{key:"getPermissions",value:function(e){return this.getAttributes(this._bucketOptions(e)).then(function(e){return e.permissions})}},{key:"setPermissions",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return this.client.execute(requests.updateBucket({id:this.name,last_modified:t.last_modified},_extends({},this._bucketOptions(t),{permissions:e})))}},{key:"batch",value:function(e,t){return this.client.batch(e,this._bucketOptions(t))}}]),e}();exports["default"]=Bucket;

},{"./collection":7,"./endpoint":8,"./requests":12,"./utils":13}],7:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),_utils=require("./utils"),_requests=require("./requests"),requests=_interopRequireWildcard(_requests),_endpoint=require("./endpoint"),_endpoint2=_interopRequireDefault(_endpoint),Collection=function(){function e(t,n,s){var i=arguments.length<=3||void 0===arguments[3]?{}:arguments[3];_classCallCheck(this,e),this.client=t,this.bucket=n,this.name=s,this.options=_extends({},this.bucket.options,i,{headers:_extends({},this.bucket.options&&this.bucket.options.headers,i.headers)}),this._isBatch=!!i.batch}return _createClass(e,[{key:"_collOptions",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=_extends({},this.options&&this.options.headers,e.headers);return _extends({},this.options,e,{headers:t,bucket:this.bucket.name})}},{key:"_updateAttributes",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=(0,_utils.toDataBody)(this.name),n=this._collOptions(e),s=requests.updateCollection(t,n);return this.client.execute(s)}},{key:"getAttributes",value:function(e){var t=this._collOptions(e),n=t.headers;return this.client.execute({path:(0,_endpoint2["default"])("collection",this.bucket.name,this.name),headers:n})}},{key:"getPermissions",value:function(e){return this.getAttributes(e).then(function(e){return e.permissions})}},{key:"setPermissions",value:function(e,t){return this._updateAttributes(_extends({},t,{permissions:e}))}},{key:"getSchema",value:function(e){return this.getAttributes(e).then(function(e){return e.data&&e.data.schema||null})}},{key:"setSchema",value:function(e,t){return this._updateAttributes(_extends({},t,{schema:e}))}},{key:"getMetadata",value:function(e){return this.getAttributes(e).then(function(e){var t=e.data;return(0,_utils.omit)(t,"schema")})}},{key:"setMetadata",value:function(e,t){return this._updateAttributes(_extends({},t,{metadata:e,patch:!0}))}},{key:"createRecord",value:function(e,t){var n=this._collOptions(t),s=requests.createRecord(this.name,e,n);return this.client.execute(s)}},{key:"updateRecord",value:function(e,t){var n=this._collOptions(t),s=requests.updateRecord(this.name,e,n);return this.client.execute(s)}},{key:"deleteRecord",value:function(e,t){var n=this._collOptions(t),s=requests.deleteRecord(this.name,(0,_utils.toDataBody)(e),n);return this.client.execute(s)}},{key:"getRecord",value:function(e,t){return this.client.execute(_extends({path:(0,_endpoint2["default"])("record",this.bucket.name,this.name,e)},this._collOptions(t)))}},{key:"listRecords",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this.client.http,n=_extends({sort:"-last_modified"},e),s=n.sort,i=n.filters,r=n.limit,a=n.pages,u=n.since,o=this.options.headers,c=(0,_endpoint2["default"])("records",this.bucket.name,this.name),l=(0,_utils.qsify)(_extends({},i,{_sort:s,_limit:r,_since:u})),h=[],d=0,_=function(e){if(!e)throw new Error("Pagination exhausted.");return f(e)},f=function(e){return t.request(e,{headers:o}).then(m)},p=function(e,t,n){return{last_modified:n,data:e,next:_.bind(null,t)}},m=function(e){var t=e.headers,n=e.json,s=t.get("Next-Page"),i=t.get("ETag");return a?(h=h.concat(n.data),d+=1,d>=a||!s?p(h,s,i):f(s)):p(n.data,s,i)};return this.client.execute(_extends({path:c+"?"+l},this._collOptions(e)),{raw:!0}).then(m)}},{key:"batch",value:function(e,t){var n=this._collOptions(t);return this.client.batch(e,_extends({},n,{collection:this.name}))}}]),e}();exports["default"]=Collection;

},{"./endpoint":8,"./requests":12,"./utils":13}],8:[function(require,module,exports){
"use strict";function endpoint(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];return ENDPOINTS[t].apply(ENDPOINTS,n)}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=endpoint;var ENDPOINTS={root:function(){return"/"},batch:function(){return"/batch"},buckets:function(){return"/buckets"},bucket:function(t){return"/buckets/"+t},collections:function(t){return ENDPOINTS.bucket(t)+"/collections"},collection:function(t,e){return ENDPOINTS.bucket(t)+"/collections/"+e},records:function(t,e){return ENDPOINTS.collection(t,e)+"/records"},record:function(t,e,n){return ENDPOINTS.records(t,e)+"/"+n}};

},{}],9:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]={104:"Missing Authorization Token",105:"Invalid Authorization Token",106:"Request body was not valid JSON",107:"Invalid request parameter",108:"Missing request parameter",109:"Invalid posted data",110:"Invalid Token / id",111:"Missing Token / id",112:"Content-Length header was not provided",113:"Request body too large",114:"Resource was modified meanwhile",115:"Method not allowed on this end point",116:"Requested version not available on this server",117:"Client has sent too many requests",121:"Resource access is forbidden for this user",122:"Another resource violates constraint",201:"Service Temporary unavailable due to high load",202:"Service deprecated",999:"Internal Server Error"};

},{}],10:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_errors=require("./errors"),_errors2=_interopRequireDefault(_errors),HTTP=function(){function e(t){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(_classCallCheck(this,e),!t)throw new Error("No events handler provided");this.events=t,r=Object.assign({},e.defaultOptions,r),this.requestMode=r.requestMode,this.timeout=r.timeout}return _createClass(e,null,[{key:"DEFAULT_REQUEST_HEADERS",get:function(){return{Accept:"application/json","Content-Type":"application/json"}}},{key:"defaultOptions",get:function(){return{timeout:5e3,requestMode:"cors"}}}]),_createClass(e,[{key:"request",value:function(t){var r=this,n=arguments.length<=1||void 0===arguments[1]?{headers:{}}:arguments[1],o=void 0,a=void 0,s=void 0,i=void 0,u=void 0;return n.headers=Object.assign({},e.DEFAULT_REQUEST_HEADERS,n.headers),n.mode=this.requestMode,new Promise(function(e,o){var a=setTimeout(function(){u=!0,o(new Error("Request timeout."))},r.timeout);fetch(t,n).then(function(t){u||(clearTimeout(a),e(t))})["catch"](function(e){u||(clearTimeout(a),o(e))})}).then(function(e){return o=e,i=e.headers,a=e.status,s=e.statusText,r._checkForDeprecationHeader(i),r._checkForBackoffHeader(a,i),e.text()}).then(function(e){return 0===e.length?null:JSON.parse(e)})["catch"](function(e){var t=new Error("HTTP "+(a||0)+"; "+e);throw t.response=o,t.stack=e.stack,t}).then(function(e){if(e&&a>=400){var t="HTTP "+a+" "+(e.error||"")+": ";if(e.errno&&e.errno in _errors2["default"]){var r=_errors2["default"][e.errno];t+=r,e.message&&e.message!==r&&(t+=" ("+e.message+")")}else t+=s||"";var n=new Error(t.trim());throw n.response=o,n.data=e,n}return{status:a,json:e,headers:i}})}},{key:"_checkForDeprecationHeader",value:function(e){var t=e.get("Alert");if(t){var r=void 0;try{r=JSON.parse(t)}catch(n){return void console.warn("Unable to parse Alert header message",t)}console.warn(r.message,r.url),this.events.emit("deprecated",r)}}},{key:"_checkForBackoffHeader",value:function(e,t){var r=void 0,n=parseInt(t.get("Backoff"),10);r=n>0?(new Date).getTime()+1e3*n:0,this.events.emit("backoff",r)}}]),e}();exports["default"]=HTTP;

},{"./errors":9}],11:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0,require("isomorphic-fetch");var _events=require("events"),_base=require("./base"),_base2=_interopRequireDefault(_base),KintoClient=function(e){function t(e){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,t);var n=r.events||new _events.EventEmitter;return _possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,Object.assign({events:n},r)))}return _inherits(t,e),t}(_base2["default"]);exports["default"]=KintoClient;

},{"./base":4,"events":1,"isomorphic-fetch":2}],12:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function safeHeader(e,t){return e?t?{"If-Match":'"'+t+'"'}:{"If-None-Match":"*"}:{}}function createBucket(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(!e)throw new Error("A bucket name is required.");var r=_extends({},requestDefaults,t),d=r.headers,o=r.permissions,n=r.safe;return{method:"PUT",path:(0,_endpoint2["default"])("bucket",e),headers:_extends({},d,safeHeader(n)),body:{permissions:o}}}function updateBucket(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if("object"!==("undefined"==typeof e?"undefined":_typeof(e)))throw new Error("A bucket object is required.");if(!e.id)throw new Error("A bucket id is required.");var r=_extends({},requestDefaults,t),d=r.headers,o=r.permissions,n=r.safe,a=r.patch,s=r.last_modified;return{method:a?"PATCH":"PUT",path:(0,_endpoint2["default"])("bucket",e.id),headers:_extends({},d,safeHeader(n,s||e.last_modified)),body:{data:e,permissions:o}}}function deleteBucket(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if("object"!==("undefined"==typeof e?"undefined":_typeof(e)))throw new Error("A bucket object is required.");if(!e.id)throw new Error("A bucket id is required.");var r=_extends({},requestDefaults,{last_modified:e.last_modified},t),d=r.headers,o=r.safe,n=r.last_modified;if(o&&!n)throw new Error("Safe concurrency check requires a last_modified value.");return{method:"DELETE",path:(0,_endpoint2["default"])("bucket",e.id),headers:_extends({},d,safeHeader(o,n))}}function deleteBuckets(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=_extends({},requestDefaults,e),r=t.headers,d=t.safe,o=t.last_modified;if(d&&!o)throw new Error("Safe concurrency check requires a last_modified value.");return{method:"DELETE",path:(0,_endpoint2["default"])("buckets"),headers:_extends({},r,safeHeader(d,o))}}function createCollection(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=_extends({},requestDefaults,t),d=r.bucket,o=r.headers,n=r.permissions,a=r.data,s=r.safe,i=e?(0,_endpoint2["default"])("collection",d,e):(0,_endpoint2["default"])("collections",d);return{method:e?"PUT":"POST",path:i,headers:_extends({},o,safeHeader(s)),body:{data:a,permissions:n}}}function updateCollection(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if("object"!==("undefined"==typeof e?"undefined":_typeof(e)))throw new Error("A collection object is required.");if(!e.id)throw new Error("A collection id is required.");var r=_extends({},requestDefaults,t),d=r.bucket,o=r.headers,n=r.permissions,a=r.schema,s=r.metadata,i=r.safe,u=r.patch,c=r.last_modified,f=_extends({},s,e);return t.schema&&(f.schema=a),{method:u?"PATCH":"PUT",path:(0,_endpoint2["default"])("collection",d,e.id),headers:_extends({},o,safeHeader(i,c||e.last_modified)),body:{data:f,permissions:n}}}function deleteCollection(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if("object"!==("undefined"==typeof e?"undefined":_typeof(e)))throw new Error("A collection object is required.");if(!e.id)throw new Error("A collection id is required.");var r=_extends({},requestDefaults,{last_modified:e.last_modified},t),d=r.bucket,o=r.headers,n=r.safe,a=r.last_modified;if(n&&!a)throw new Error("Safe concurrency check requires a last_modified value.");return{method:"DELETE",path:(0,_endpoint2["default"])("collection",d,e.id),headers:_extends({},o,safeHeader(n,a))}}function createRecord(e,t){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(!e)throw new Error("A collection name is required.");var d=_extends({},requestDefaults,r),o=d.bucket,n=d.headers,a=d.permissions,s=d.safe;return{method:t.id?"PUT":"POST",path:t.id?(0,_endpoint2["default"])("record",o,e,t.id):(0,_endpoint2["default"])("records",o,e),headers:_extends({},n,safeHeader(s)),body:{data:t,permissions:a}}}function updateRecord(e,t){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(!e)throw new Error("A collection name is required.");if(!t.id)throw new Error("A record id is required.");var d=_extends({},requestDefaults,r),o=d.bucket,n=d.headers,a=d.permissions,s=d.safe,i=d.patch,u=d.last_modified;return{method:i?"PATCH":"PUT",path:(0,_endpoint2["default"])("record",o,e,t.id),headers:_extends({},n,safeHeader(s,u||t.last_modified)),body:{data:t,permissions:a}}}function deleteRecord(e,t){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(!e)throw new Error("A collection name is required.");if("object"!==("undefined"==typeof t?"undefined":_typeof(t)))throw new Error("A record object is required.");if(!t.id)throw new Error("A record id is required.");var d=_extends({},requestDefaults,{last_modified:t.last_modified},r),o=d.bucket,n=d.headers,a=d.safe,s=d.last_modified;if(a&&!s)throw new Error("Safe concurrency check requires a last_modified value.");return{method:"DELETE",path:(0,_endpoint2["default"])("record",o,e,t.id),headers:_extends({},n,safeHeader(a,s))}}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var d in r)Object.prototype.hasOwnProperty.call(r,d)&&(e[d]=r[d])}return e};exports.createBucket=createBucket,exports.updateBucket=updateBucket,exports.deleteBucket=deleteBucket,exports.deleteBuckets=deleteBuckets,exports.createCollection=createCollection,exports.updateCollection=updateCollection,exports.deleteCollection=deleteCollection,exports.createRecord=createRecord,exports.updateRecord=updateRecord,exports.deleteRecord=deleteRecord;var _endpoint=require("./endpoint"),_endpoint2=_interopRequireDefault(_endpoint),requestDefaults={safe:!1,headers:{},bucket:"default",permissions:{},data:{},patch:!1};

},{"./endpoint":8}],13:[function(require,module,exports){
"use strict";function partition(r,t){return 0>=t?r:r.reduce(function(r,n,e){return 0===e||e%t===0?r.push([n]):r[r.length-1].push(n),r},[])}function pMap(r,t){var n=[];return r.reduce(function(r,e){return r.then(function(){return Promise.resolve(t(e)).then(function(r){return n=n.concat(r)})})},Promise.resolve()).then(function(){return n})}function omit(r){for(var t=arguments.length,n=Array(t>1?t-1:0),e=1;t>e;e++)n[e-1]=arguments[e];return Object.keys(r).reduce(function(t,e){return-1===n.indexOf(e)&&(t[e]=r[e]),t},{})}function toDataBody(r){if("object"===("undefined"==typeof r?"undefined":_typeof(r)))return r;if("string"==typeof r)return{id:r};throw new Error("Invalid collection argument.")}function qsify(r){var t="&",n=function(r){return encodeURIComponent("boolean"==typeof r?String(r):r)},e=function(r){return JSON.parse(JSON.stringify(r))},o=e(r);return Object.keys(o).map(function(r){var e=n(r)+"=";return Array.isArray(o[r])?o[r].map(function(r){return e+n(r)}).join(t):e+n(o[r])}).join(t)}function checkVersion(r,t,n){var e=function(r){return r.split(".").map(function(r){return parseInt(r,10)})},o=e(r),i=_slicedToArray(o,2),u=i[0],a=i[1],c=e(t),f=_slicedToArray(c,2),s=f[0],p=f[1],y=e(n),l=_slicedToArray(y,2),h=l[0],d=l[1],m=[s>u,u===s&&p>a,u>h,u===h&&a>=d];if(m.some(function(r){return r}))throw new Error("Version "+r+" doesn't satisfy "+(t+" <= x < "+n))}function support(r,t){return function(n,e,o){var i=o.value;return{configurable:!0,get:function(){var n=this,o=function(){for(var e=arguments.length,o=Array(e),u=0;e>u;u++)o[u]=arguments[u];var a="client"in n?n.client:n;return a.fetchHTTPApiVersion().then(function(n){return checkVersion(n,r,t)}).then(Promise.resolve(i.apply(n,o)))};return Object.defineProperty(this,e,{value:o,configurable:!0,writable:!0}),o}}}}function nobatch(r){return function(t,n,e){var o=e.value;return{configurable:!0,get:function(){var t=this,e=function(){for(var n=arguments.length,e=Array(n),i=0;n>i;i++)e[i]=arguments[i];if(t._isBatch)throw new Error(r);return o.apply(t,e)};return Object.defineProperty(this,n,{value:e,configurable:!0,writable:!0}),e}}}}Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(){function r(r,t){var n=[],e=!0,o=!1,i=void 0;try{for(var u,a=r[Symbol.iterator]();!(e=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);e=!0);}catch(c){o=!0,i=c}finally{try{!e&&a["return"]&&a["return"]()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return r(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol?"symbol":typeof r};exports.partition=partition,exports.pMap=pMap,exports.omit=omit,exports.toDataBody=toDataBody,exports.qsify=qsify,exports.checkVersion=checkVersion,exports.support=support,exports.nobatch=nobatch;

},{}]},{},[11])(11)
});